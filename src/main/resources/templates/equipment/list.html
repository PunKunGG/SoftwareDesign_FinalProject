<!DOCTYPE html>
<html lang="th" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{layouts/new_app :: ~{html} (content = ~{::content})}">

<body>
	<div th:fragment="content" class="container mt-4">

		<!-- ✅ ส่วนแสดงข้อความแจ้งเตือน -->
		<div th:if="${error}"
			class="alert alert-danger alert-dismissible fade show" role="alert">
			<span th:text="${error}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"
				aria-label="Close"></button>
		</div>

		<div th:if="${success}"
			class="alert alert-success alert-dismissible fade show" role="alert">
			<span th:text="${success}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"
				aria-label="Close"></button>
		</div>
		<!-- ✅ จบส่วนแจ้งเตือน -->

		<div class="card shadow-sm p-4">
			<h2 class="fw-bold text-archery mb-3">รายการอุปกรณ์</h2>

			<!-- ปุ่มเพิ่มอุปกรณ์ เฉพาะ ADMIN และ SUPER_ADMIN -->
			<div class="mb-3"
				th:if="${#authorization.expression('hasAnyAuthority(''ADMIN'',''SUPER_ADMIN'')')}">
				<a class="btn btn-confirm" th:href="@{/equipment/new}">➕
					เพิ่มอุปกรณ์</a>
			</div>

			<!-- ตารางอุปกรณ์ -->
			<table class="table table-striped table-hover">
				<thead class="table-light">
					<tr>
						<th>ID</th>
						<th>ชื่ออุปกรณ์</th>
						<th>หมวดหมู่</th>
						<th>จำนวน</th>
						<th>สถานะ</th>
						<th>การจัดการ</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="e : ${equipments}">
						<td th:text="${e.id}"></td>
						<td th:text="${e.name}"></td>
						<td th:text="${e.category}"></td>
						<td th:text="${e.quantity}"></td>
						<td><span
							th:classappend="${e.status == 'Available'} ? 'badge bg-success'
								: (e.status == 'Maintenance' ? 'badge bg-warning text-dark' : 'badge bg-danger')"
							th:text="${e.status}"> </span></td>
						<td>
							<!-- MEMBER เห็นเฉพาะปุ่มยืม -->
							<div
								th:if="${#authorization.expression('hasAnyAuthority(''ROLE_MEMBER'',''ROLE_ADMIN'',''ROLE_SUPER_ADMIN'')')}">
								<form th:action="@{|/loans/borrow/${e.id}|}" method="post"
									class="d-inline">
									<input type="number" name="quantity" min="1"
										max="${e.quantity}" value="1" class="form-control d-inline"
										style="width: 80px;" />
									<button type="submit" class="btn btn-sm btn-success"
										th:disabled="${e.status != 'Available'}">ยืม</button>
								</form>
							</div> <!-- ADMIN / SUPER_ADMIN เห็นปุ่มแก้ไข/ลบ -->
							<div
								th:if="${#authorization.expression('hasAnyAuthority(''ROLE_ADMIN'',''ROLE_SUPER_ADMIN'')')}">
								<a class="btn btn-sm btn-primary"
									th:href="@{|/equipment/${e.id}/edit|}">แก้ไข</a>
								<form th:action="@{|/equipment/${e.id}/delete|}" method="post"
									class="d-inline">
									<button type="submit" class="btn btn-sm btn-danger"
										onclick="return confirm('คุณแน่ใจว่าจะลบอุปกรณ์นี้หรือไม่?')">ลบ</button>
								</form>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

	</div>
</body>
</html>
